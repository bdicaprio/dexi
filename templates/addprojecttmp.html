<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>layout 后台大布局 - Layui</title>
  <link rel="stylesheet" href="/static/css/layui.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
  <div class="layui-body" style="margin-left:-180px;">
    <!-- 内容主体区域 -->
    <div style="padding: 15px;">
        <div class="layui-tab">
             <div class="layui-tab-content">
               <div class="layui-tab-item layui-show" style="margin-top:-50px;">
                          <form class="layui-form" action='' onsubmit="return dosubmit();" lay-filter="example">{% csrf_token %}
                                      <div class="layui-form-item">
                                            <input type="hidden" name="id" id="id"  value={{  result.id  }}>
                                            <label class="layui-form-label-project">项目名称</label>
                                                <div class="layui-input-block">
                                                      <input class="layui-input-project" type="text" name="projectName" id="projectName" lay-verify="title" autocomplete="off" placeholder="请输入项目名称" value={{  result.projectName  }}>
                                                </div>
                                      </div>
                                      
                                      
                                      
                                       <div class="layui-form-item">
                                              <div class="layui-inline">
                                                      <label class="layui-form-label-project">项目来源</label>
                                                      <div class="layui-input-inline">
                                                            <input type="text" name="projectFrom"  autocomplete="off" id="projectFrom" class="layui-input-project-small" value={{  result.projectFrom  }}>
                                                      </div>
                                              </div>
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">开展形式</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="developmentForm" id="developmentForm"  autocomplete="off" class="layui-input-project-small" value={{  result.developmentForm  }}>
                                                      </div>
                                               </div>
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">成果展示</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="achievement" id="achievement"   autocomplete="off" class="layui-input-project-small" value={{  result.achievement  }}>
                                                      </div>
                                               </div>     
                                              <div class="layui-inline">
                                                      <label class="layui-form-label-project">经济目标</label>
                                                      <div class="layui-input-inline">
                                                            <input type="text" name="economicGoals"  autocomplete="off" class="layui-input-project-small" value={{  result.economicGoals  }}>
                                                      </div>
                                              </div>                                                                                           
                                        </div>  
                                        
                                        
                                       <div class="layui-form-item">
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">活动类型</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="activityType" id="activityType"  autocomplete="off" class="layui-input-project-small" value={{  result.activityType  }}>
                                                      </div>
                                               </div>
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">所处阶段</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="stage" id="stage"   autocomplete="off" class="layui-input-project-small" value={{  result.stage  }}>
                                                      </div>
                                               </div> 
                                              <div class="layui-inline">
                                                      <label class="layui-form-label-project">起始时间</label>
                                                      <div class="layui-input-inline">
                                                            <input type="text" name="startTime" id="startTime" placeholder="yyyy-MM-dd"  autocomplete="off" class="layui-input-project-small" value={{  result.startTime|date:"Y-m-d H:i:s"  }}>
                                                      </div>
                                              </div>
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">完成时间</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="endTime" id="endTime"   placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input-project-small" value={{  result.endTime | date:"Y-m-d H:i:s" }}>
                                                      </div>
                                               </div>                                                                                                 
                                        </div> 
                                        
                                        
                                       <div class="layui-form-item">                                            
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">参加人员（人）</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="personnel" id="personnel"  autocomplete="off" class="layui-input-project-small" value={{  result.personnel  }}>
                                                      </div>
                                               </div>                                               
                                              <div class="layui-inline">
                                                      <label class="layui-form-label-project">经费（千元）</label>
                                                      <div class="layui-input-inline">
                                                            <input type="text" name="funds"  autocomplete="off" class="layui-input-project-small" value={{  result.funds  }}>
                                                      </div>
                                              </div>
                                              <div class="layui-inline">
                                                     <label class="layui-form-label-project">政府资金（千元）</label>
                                                     <div class="layui-input-inline">
                                                           <input type="text" name="capital" id="capital"  autocomplete="off" class="layui-input-project-small" value={{  result.capital  }}>
                                                      </div>
                                               </div>  
                                         </div>
                                         <div class="layui-form-item">                                              
                                              <div class="layui-inline">
                                                         <div style="margin-left:300px;width:100%;height:50px;">
                                                                <div style="display:block;float:right" id="layerDemo">                        
                                                                       <!-- <button data-method="offset" data-type="auto" class="layui-btn" id="add-project">添加</button>
                                                                        <button data-method="offset" data-type="auto" class="layui-btn" id="cancel-project">取消</button>-->
                                                                        <input type='hidden' id='companyName' name='companyName' />
                                                                        <input type="hidden" name="id" id="id"  value={{  result.id  }}>
                                                                        <input type='submit' class='layui-btn' value='保存'  lay-submit="" lay-filter="save-project">  
                                                                        <input type='submit' class='layui-btn' value='取消'  lay-submit="" lay-filter="cancal-project">                                                                                                                                                   
                                                                </div>
                                                         </div>                                                      
                                               </div>                                               
                                        </div>                                                                                                                                                                  
	                        </form>

             </div>                 
           </div>
        </div>
    </div>
  </div>
</div>
 
<script src="/static/layui.js"></script>
<script src="/static/jquery.min.js" type="text/javascript"></script>
<script>
//JavaScript代码区域
layui.use(['jquery','element','form', 'layedit', 'laydate'], function(){
          var $ = layui.$
          ,element = layui.element
          ,form = layui.form
          ,layer = layui.layer
          ,layedit = layui.layedit
          ,laydate = layui.laydate;
              
           laydate.render({
              elem: '#startTime'
          });
    
          laydate.render({
              elem: '#endTime'
          });
          
          
          companyName = window.parent.document.getElementById("managerCompanyName").value;
         
          $('#companyName').val(companyName)  <!--获取父页面的值 -->
          
          
         
          
          var index = parent.layer.getFrameIndex(window.name);
     
          form.on('submit(save-project)', function(data){                                   
               $.ajax({
       		   type: 'POST',
       		   data:data.field,
               url: '/saveProjectTmp/',
       		   cache: false,
       		   async: false,
  		       success:function(data){　　　　　　　　　
  		    	     parent.layer.alert("添加成功", { });
  		    	     parent.layui.table.reload('idTest1',{
  		    	         where: {companyname : companyName }	    	     
  		    	        ,page: {}
  		    	      });
  		    	        
  		    	     parent.layer.close(index);
  		    	     
       		   },error:function(){
            	     parent.layer.alert('公司名称未填写或公司已添加过');
               }                
           })
       });

          form.on('submit(cancal-project)', function(data){
        	    parent.layer.close(index);         	  
          });
          
          
          
          
}); 
   


</script>
</body>
</html>